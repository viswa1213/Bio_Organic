<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="./product.css" />
  </head>
  <body>
    <!-- navbar                 -->
  <nav class="navbar navbar-expand-lg bg-body-teritary" id="navbar">
    <div class="container-fluid">
      <a href="../index.html"><img src="./assets/biOrganic.png" alt="logo"></a>
      <a class="navbar-brand" href="#">BIORGANIC</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mx-auto">
          <li class="nav-item">
            <a style="color: white;" class="nav-link" href="../index.html">Home</a>
          </li>
          <li class="nav-item">
            <a style="color: white;" class="nav-link" href="./product.html">product</a>
          </li>
          <li class="nav-item">
            <a style="color: white;" class="nav-link" href="#">about</a>
          </li>
          <li class="nav-item">
            <a style="color: white; margin-right: 40px;" class="nav-link" href="../index.html#contact">contact</a>
          </li>
          
        </ul>
      </div>
       <a href="./login.html"><button class="btn p-2 my-lg-0 my-2">sign in</button></a> 
      </div>
  </nav>
    <!-- cards   -->
    <div class="totalcards" id="totalcards">
                       <!-- body of the card dynamically inserted -->
    </div>

<script>
  // Load product data from JSON and render cards
  fetch('../JSON/products.json')
    .then(response => response.json())
    .then(products => {
      const container = document.getElementById('totalcards');
      products.forEach(product => {
        const col = document.createElement('div');
        col.className = "card";

        col.innerHTML = `
          <div class="content">
            <img src="${product.image}" class="pimage" alt="${product.name}">
            <p class="pname">${product.name}</p>
            <div class="details">
              <p class="price">$${product.price}</p>
            <div>
              <button class="btn" onclick = "savedata(this)" id = "addtocart">Add to Cart</button>
              <button class="btn" id = "buy">Buy</button>
          </div>
        </div>
        `;

        container.appendChild(col);
      });

      // Add event listeners after products are loaded
      document.querySelectorAll(".addToCart").forEach(button => {
        button.addEventListener("click", function () {
          savedata(this);
        });
      });
    });

  // Save product to cart in localStorage
  function savedata(button) {
    const card = button.closest(".card");

    const pimage = card.querySelector(".pimage").getAttribute('src');
    const pname = card.querySelector(".pname").innerText;
    const pprice = card.querySelector(".price").innerText;

    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    const existingItem = cart.find(item => item.name === pname);

    if (existingItem) {
      existingItem.quantity += 1;
    } else {
      cart.push({
        name: pname,
        price: pprice,
        image: pimage,
        quantity: 1
      });
    }

    localStorage.setItem("cart", JSON.stringify(cart));
    alert("Product added to cart!");
    // Optional: redirect
    window.location.href = "./addtocart.html";
  }
</script>

</body>
</html>
